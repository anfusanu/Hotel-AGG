
	<main>
		<section class="hero_in tours" style="background: url('/user-template/img/hero_in_bg_1.jpg' !important);">
			<div class="wrapper">
				<div class="container">
					<h1 class="fadeInUp"><span></span>Profile</h1>
				</div>
			</div>
		</section>
		<!--/hero_in--> 

		<div class="container margin_60_35">
			<div class="row">
				<aside class="col-lg-3" id="sidebar">
						<div class="box_style_cat" id="faq_box">
							<ul id="cat_nav">
								<li><a href="#profile" class="active"><i class="icon_document_alt"></i>Profile</a></li>
								<li><a href="#history"><i class="icon_document_alt"></i>Order History</a></li>
								<li><a href="#settings"><i class="icon_document_alt"></i>Settings</a></li>
								
							</ul>
						</div>
						<!--/sticky -->
				</aside>
				<!--/aside -->
				
				<div class="col-lg-9" id="faq">
					<h4 class="nomargin_top">Profile</h4>
					<div role="tablist" class="add_bottom_45 accordion_2" id="profile">
						<div class="card">
							<div class="card-header" role="tab">
								<h5 class="mb-0">
									<a data-toggle="collapse" href="#collapseOne_payment" aria-expanded="true"><i class="indicator ti-minus"></i>Update your profile</a>
								</h5>
							</div>

							<div id="collapseOne_payment" class="collapse show" role="tabpanel" data-parent="#profile">
								<div class="card-body">
								<form action="/user/update-profile" method="POST" id="userForm">
									<div class="row">
									<div class="col-sm-6 col-md-6">
										<div class="form-group">
											<label>Email</label>
											<input type="text" class="form-control" readonly
												value="{{userDetails.userEmail}}" />
										</div>
									</div>
									<div class="col-sm-6  col-md-6">
										<div class="form-group">
											<label>Phone number</label>
											<input type="text" id="userPhone" name="userPhone" class="form-control" required
												value="{{userDetails.userPhone}}" />
										</div>
									</div>
									<div class="col-sm-6 col-md-6">
										<div class="form-group">
											<label>First Name</label>
											<input type="text" class="form-control" id="firstName" name="firstName" required
												value="{{userDetails.firstName}}" />
										</div>
									</div>
									<div class="col-sm-6  col-md-6">
										<div class="form-group">
											<label>Last Name</label>
											<input type="text" id="lastName" name="lastName" class="form-control"
												value="{{userDetails.lastName}}" />
										</div>
									</div>

									<div class="col-sm-6  col-md-6">
										<div class="form-group">
											<input type="submit" value="UPDATE" class="btn btn-primary"/>
										</div>
									</div>
									</div>

								</form>	
								</div>
							</div>
						</div>
						
						<!-- /card -->
					</div>
					<!-- /accordion payment -->
					
					<h4 class="nomargin_top">Order History</h4>
					<div role="tablist" class="add_bottom_45 accordion_2" id="history">
						<!-- /card -->

						<div class="card">
							<div class="card-header" role="tab">
								<h5 class="mb-0">
									<a data-toggle="collapse" href="#collapseOne_tips" aria-expanded="true"><i class="indicator ti-plus"></i>Your History</a>
								</h5>
							</div>

							<div id="collapseOne_tips" class="collapse" role="tabpanel" data-parent="#history">
								<div class="card-body">

									{{#if orderHistory}}

										{{#each orderHistory}}
									<div class="row">
										<div class="col-md-2 pt-3">{{this._id}} </div>
										<div class="col-md-2 pt-3 totalAmount">{{this.totalAmount}} </div>
										<div class="col-md-2 pt-3">{{this.paymentMethod}} <br/> {{this.paymentStatus}} </div>
										<div class="col-md-2 pt-3 dateCheckIn">{{this.dateCheckIn}} </div>
										<div class="col-md-2 pt-3 dateCheckOut">{{this.dateCheckOut}} </div>
										<div class="col-md-2 pt-3">
										<button class="btn btn-outline-primary mx-2" onclick="window.location.href = '/user/order-invoice/{{this._id}}'">Invoice </button>
										{{#ifEqual this.orderStatus 'Waiting'}}
										<button class="btn btn-outline-danger mt-2 mx-2">Cancel </button>
										{{/ifEqual}}
										</div>

									</div>
										<hr>



										{{/each}}

									{{else}}
									<p>NO DATA</p>
									{{/if}}
								</div>
							</div>
						</div>
						<!-- /card -->
						
				
					</div>
					<!-- /accordion suggestions -->

					<h4 class="nomargin_top">Settings</h4>
					<div role="tablist" class="add_bottom_45 accordion_2" id="settings">
						<div class="card">
							<div class="card-header" role="tab">
								<h5 class="mb-0">
									<a data-toggle="collapse" href="#collapseOne_payment" aria-expanded="true"><i class="indicator ti-minus"></i>Update your password</a>
								</h5>
							</div>

							<div id="collapseOne_payment" class="collapse show" role="tabpanel" data-parent="#settings">
								<div class="card-body">
								<form action="/user/update-password" method="POST" id="changePassForm">
									<div class="row">
											<div class="col-sm-12  col-md-6">
										<div class="form-group">
											<label>Old password</label>
											<input type="password" id="passKey" name="passKey" class="form-control" required/>
										</div>
									</div>
									</div>

									<div class="row">
								
								
									<div class="col-sm-6 col-md-6">
										<div class="form-group">
											<label>New password</label>
											<input type="password" class="form-control" id="newPassKey" name="newPassKey" required/>
										</div>
									</div>
									<div class="col-sm-6  col-md-6">
										<div class="form-group">
											<label>Confirm password</label>
											<input type="password" id="conPassKey" class="form-control"required/>
										</div>
									</div>

									<div class="col-sm-6  col-md-6">
										<div class="form-group">
											<input type="submit" value="UPDATE" class="btn btn-primary"/>
										</div>
									</div>
									</div>

								</form>	
								</div>
							</div>
						</div>
						
						<!-- /card -->
					</div>

				
					
				</div>
				<!-- /col -->
			</div>
			<!-- /row -->
		</div>
		<!--/container-->
	</main>
	<!--/main-->

<script src="/templates/user-template/js/jquery-2.2.4.min.js"></script>
<script src="/templates/user-template/js/common_scripts.js"></script>
<script src="/templates/user-template/js/main.js"></script>
<script src="/templates/user-template/assets/validate.js"></script>



  <!-- SPECIFIC SCRIPTS -->
<script src="/templates/user-template/js/pw_strenght.js"></script>

<script>
	var formatter = new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'INR',

      // These options are needed to round to whole numbers if that's what you want.
      //minimumFractionDigits: 0, // (this suffices for whole numbers, but will print 2500.10 as $2,500.1)
      //maximumFractionDigits: 0, // (causes 2500.99 to be printed as $2,501)
    });


	$( ".totalAmount" ).each(function( index ) {
  		$( this ).html(formatter.format(parseFloat($(this).text()))) ;
	});
  </script>
<script src="https://momentjs.com/downloads/moment.js"></script>

  <script>
	  $( ".dateCheckIn" ).each(function( index ) {
		let thisDate = $(this).text()
		let value = moment(thisDate).format("dddd, MMMM Do YYYY");
  		$( this ).html(value) ;
	});
	 $( ".dateCheckOut" ).each(function( index ) {
		let thisDate = $(this).text()
		let value = moment(thisDate).format("dddd, MMMM Do YYYY");
  		$( this ).html(value) ;
	});

  </script>

  <script>
	  document.getElementById('changePassForm').addEventListener('submit', (event) => {
		event.preventDefault()

		const passKey = document.getElementById('passKey').value;
		const newPassKey = document.getElementById('newPassKey').value;
		const requestOptions = {
		method: "POST",
		headers: {
			"Content-Type": "application/json"
		},
		body: JSON.stringify({
			passKey,
			newPassKey
		}),
		}
		fetch(`/user/update-password`, requestOptions)
		.then((response) => response.json())
		.then((data) => {
			if (!data.isMatch) alert(data.message)
			else  alert("Password changed")
			document.getElementById('passKey').value = ''
			document.getElementById('newPassKey').value = ''
			document.getElementById('conPassKey').value = ''

			
		})
		.catch((err) => console.log(err));
	  })



	  document.getElementById('userForm').addEventListener('submit', (event) => {
		event.preventDefault()

		const firstName = document.getElementById('firstName').value;
		const lastName = document.getElementById('lastName').value;
		const userPhone = document.getElementById('userPhone').value;

		const requestOptions = {
		method: "POST",
		headers: {
			"Content-Type": "application/json"
		},
		body: JSON.stringify({
			firstName,
			lastName,
			userPhone
		}),
		}
		fetch(`/user/update-profile`, requestOptions)
		.then((response) => response.json())
		.then((data) => {
			if (!data.isSuccess) alert(data.message)
			else  alert("Profile Updated")

			
		})
		.catch((err) => console.log(err));
	  })
  </script>